---
title: "æˆ‘çš„æ‹·é¢ç»ï¼ˆä¸€ï¼‰"
date: 2022-06-08T00:30:50+08:00
lastmod: 2022-06-19 08:09:57
draft: false
tags: ["å…«è‚¡æ–‡", "é¢ç»"]
author: ["zzydev"]
description: ""
weight: 2 # è¾“å…¥1å¯ä»¥é¡¶ç½®æ–‡ç« ï¼Œç”¨æ¥ç»™æ–‡ç« å±•ç¤ºæ’åºï¼Œä¸å¡«å°±é»˜è®¤æŒ‰æ—¶é—´æ’åº
slug: ""
comments: true
showToc: true # æ˜¾ç¤ºç›®å½•
TocOpen: true # è‡ªåŠ¨å±•å¼€ç›®å½•
hidemeta: false # æ˜¯å¦éšè—æ–‡ç« çš„å…ƒä¿¡æ¯ï¼Œå¦‚å‘å¸ƒæ—¥æœŸã€ä½œè€…ç­‰
disableShare: false # åº•éƒ¨ä¸æ˜¾ç¤ºåˆ†äº«æ 
showbreadcrumbs: true #é¡¶éƒ¨æ˜¾ç¤ºå½“å‰è·¯å¾„
cover:
    image: "https://zzydev-1255467326.cos.ap-guangzhou.myqcloud.com/eight-part-essay/1-kmj.png"
    caption: ""
    alt: ""
    relative: true
---

---

{{<quote-center >}}

æˆ‘æ˜¯æ²¡äº‹çš„æ—¶å€™  
åœ¨æ— èŠçš„æ—¶å€™ï¼Œæƒ³çš„æ—¶å€™  
åˆ°ä¸€ä¸ªåœ°æ–¹ï¼Œä¸ç›¸åŒçš„åœ°æ–¹  
åˆ°è¿™ä¸ªåœ°æ–¹æ¥ï¼Œæ¥åˆ°å§  
å¯ä»¥ç§ç§ï¼Œä¸ä¸€æ ·çš„åœ°æ–¹  
ä¸ç›¸åŒçš„åœ°æ–¹  
å¾ˆå¤šï¼Œå¾ˆå¤šâ€¦â€¦

--------- æ·³Â·ç®€Â·æ‹‰åŸºèŒ¨å¾·

{{< /quote-center >}}

<br/>

---

{{< spoiler  "Symbolä¸èƒ½ä½¿ç”¨newæ“ä½œç¬¦ï¼Œé‚£å¦‚ä½•å¾—åˆ°ä¸€ä¸ªSymbolç±»å‹çš„å¯¹è±¡">}}

```javascript
//åˆ©ç”¨ä¸€ä¸ªå‡½æ•°çš„callæ–¹æ³•æ¥å¼ºè¿«äº§ç”Ÿè£…ç®±
var symbolObject = function () {
    return this;
}.call(Symbol("a"));

console.log(typeof symbolObject); //object
console.log(symbolObject instanceof Symbol); //true
console.log(symbolObject.constructor == Symbol); //true

//ä½¿ç”¨å†…ç½®çš„ Object å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ JavaScript ä»£ç ä¸­æ˜¾å¼è°ƒç”¨è£…ç®±èƒ½åŠ›
var symbolObject = Object(Symbol("a"));

console.log(typeof symbolObject); //object
console.log(symbolObject instanceof Symbol); //true
console.log(symbolObject.constructor == Symbol); //true

//æ¯ä¸€ç±»è£…ç®±å¯¹è±¡çš†æœ‰ç§æœ‰çš„Classå±æ€§ï¼Œè¿™äº›å±æ€§å¯ä»¥ç”¨ Object.prototype.toString è·å–ï¼š
console.log(Object.prototype.toString.call(symbolObject)); //[object Symbol]
//åœ¨JSä¸­ï¼Œæ²¡æœ‰ä»»ä½•æ–¹æ³•å¯ä»¥æ›´æ”¹ç§æœ‰çš„Classå±æ€§
```

{{< /spoiler >}}

{{< spoiler  "new fnä¸new fn()æœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼Ÿ">}}

```javascript
function Parent() {
    this.num = 1;
}
console.log(new Parent()); //è¾“å‡ºParentå¯¹è±¡ï¼š{num:1}
console.log(new Parent()); //è¾“å‡ºParentå¯¹è±¡ï¼š{num:1}

function Parent() {
    this.num = 1;
}
console.log(new Parent().num); //1
console.log(new Parent.num()); //æŠ¥é”™
```

ä»æŠ¥é”™ä¿¡æ¯æ¥çœ‹ï¼Œ`new Parent.num`æ‰§è¡Œé¡ºåºæ˜¯è¿™æ ·çš„ï¼šå…ˆæ‰§è¡Œ`Parent.num`ï¼Œæ­¤æ—¶è¿”å›ç»“æœä¸º`undefined`ï¼›åæ‰§è¡Œ`new`ï¼Œå› `new`åé¢å¿…é¡»è·Ÿæ„é€ å‡½æ•°ï¼Œæ‰€ä»¥`new undefined`ä¼šæŠ¥é”™ã€‚

`new Parent().num`ç›¸å½“äº`(new Parent()).num`ï¼Œæ‰€ä»¥ç»“æœè¿”å› 1ã€‚

{{< /spoiler >}}

{{< spoiler  "æ‹†ç®±è½¬æ¢ç›¸å…³é—®é¢˜">}}

å¯¹è±¡åˆ° String å’Œ Number çš„è½¬æ¢éƒ½éµå¾ªâ€œå…ˆæ‹†ç®±å†è½¬æ¢â€çš„è§„åˆ™ã€‚é€šè¿‡æ‹†ç®±è½¬æ¢ï¼ŒæŠŠå¯¹è±¡å˜æˆåŸºæœ¬ç±»å‹ï¼Œå†ä»åŸºæœ¬ç±»å‹è½¬æ¢ä¸ºå¯¹åº”çš„åŸå§‹ç±»å‹ã€‚

Symbol.toPrimitive æ˜¯ä¸€ä¸ªå†…ç½®çš„ Symbol å€¼ï¼Œå®ƒæ˜¯ä½œä¸ºå¯¹è±¡çš„å‡½æ•°å€¼å±æ€§å­˜åœ¨çš„ï¼Œå½“ä¸€ä¸ªå¯¹è±¡è½¬æ¢ä¸ºå¯¹åº”çš„åŸå§‹å€¼æ—¶ï¼Œä¼šè°ƒç”¨æ­¤å‡½æ•°ã€‚

```javascript
var o = {
    valueOf: () => {
        console.log("valueOf");
        return {};
    },
    toString: () => {
        console.log("toString");
        return {};
    },
};

o[Symbol.toPrimitive] = () => {
    return "hello";
};
console.log(o + "");
// hello

// ç»ƒä¹ ä¸€
const arr = [4, 10];
arr[Symbol.toPrimitive] = function (hint) {
    return hint;
};
arr.valueOf = function () {
    return this;
};
const obj = {} + arr + obj + arr + obj; //'NaN[object Object]default[object Object]'
{
}
+arr; //[object Object]default'

// ç»ƒä¹ äºŒ
const val =
    (([] == ![][(+val, [] + 1)]) == // ''è½¬æ•°å­—ä¸º0
        [1, 1] + [][(+val, [] + 1)]) == //[1, '1'].toString() == [1, 1] + ''  =>  '1, 1' == '1, 1'  true
    [1, "1"]; // false
```

{{< /spoiler >}}

{{< spoiler  "[]â•[]ï¼Œ[]â•{}ï¼Œ{}â•[]ï¼Œ{}â•{}">}}

```javascript
// äºŒå…ƒæ“ä½œç¬¦ + çš„è§„åˆ™
// å¦‚æœæ“ä½œæ•°æ˜¯å¯¹è±¡ï¼Œåˆ™å¯¹è±¡ä¼šè½¬æ¢ä¸ºåŸå§‹å€¼
// å¦‚æœå…¶ä¸­ä¸€ä¸ªæ“ä½œæ•°æ˜¯å­—ç¬¦ä¸²ï¼Œå¦ä¸€ä¸ªæ“ä½œæ•°ä¹Ÿä¼šè½¬æ¢ä¸ºå­—ç¬¦ä¸²è¿›è¡Œæ‹¼æ¥
// å¦åˆ™ä¸¤ä¸ªæ“ä½œæ•°éƒ½å°†è½¬æ¢ä¸ºæ•°å­—æˆ–è€…NaNï¼Œè¿›è¡ŒåŠ æ³•æ“ä½œ
10n + 10
Symbol(10) + 10

// å¯¹è±¡è½¬æ¢ä¸ºåŸå§‹æ•°æ®ç±»å‹çš„å€¼
// Symbol.toPrimitive ä¼˜å…ˆçº§æœ€é«˜
// Object.prototype.valueOf  // è°ƒç”¨ valueOfï¼Œå¦‚æœè½¬æ¢ä¸ºåŸå§‹ç±»å‹ï¼Œå°±è¿”å›è½¬æ¢çš„å€¼ã€‚å¦‚æœä¸è¿”å›åŸå§‹ç±»å‹çš„å€¼å°±è°ƒç”¨toStringã€‚
// Object.prototype.toString // è°ƒç”¨toStringï¼Œå¦‚æœè½¬æ¢ä¸ºåŸå§‹ç±»å‹ï¼Œå°±è¿”å›è½¬æ¢çš„å€¼ã€‚å¦‚æœä¸è¿”å›åŸå§‹ç±»å‹çš„å€¼å°±è°ƒç”¨valueOfã€‚
typeof [][Symbol.toPrimitive] // undefined
[].valueOf() // []
[].toString() // ''  æ‰€ä»¥[]è½¬æ¢ä¸ºåŸå§‹å€¼æ˜¯â€˜â€™

typeof {}[Symbol.toPrimitive] //undefined
({}).valueOf() // {}
({}).toString() // '[object Object]'

[] + [] // ""
[] + {} // "[object Object]"
{} + [] // 0  ç›¸å½“äº {}; + []
{} + {} // Chrome '[object Object][object Object]' å…¶ä»–æµè§ˆå™¨ NaN
```

{{< /spoiler >}}

{{< spoiler  "toStringç›¸å…³é—®é¢˜">}}

```javascript
const user = {
    name: "zzy",
    id: 233,
    valueOf() {
        return this.id;
    },
};

console.log(`${user}`); //ä¼šè°ƒç”¨åŸå‹é“¾ä¸Šçš„toString è¿”å›[object Object]
Object.prototype.toString = undefined;
console.log(`${user}`); // 233
```

```javascript
Object.prototype.toString.call(Boolean.prototype); // [object Boolean]
```

{{< /spoiler >}}

{{< spoiler  "px % rem vh/vwæœ‰ä»€ä¹ˆåŒºåˆ«">}}
px æ˜¯ç»å¯¹å•ä½ï¼Œ  
% æ˜¯ç›¸å¯¹äºçˆ¶å…ƒç´ çš„æ¯”ä¾‹ï¼Œ  
em æ˜¯ç›¸å¯¹äºå½“å‰å…ƒç´ çš„ font-sizeï¼Œrem æ˜¯ç›¸å¯¹ä¸æ ¹(root)å…ƒç´ çš„ font-sizeï¼Œ

```html
<div style="font-size:20px">
    <p style="text-indent: 2em; font-size: 40px">é¦–è¡Œç¼©è¿›</p>
    <p style="text-indent: 2em">
        è¿™ä¸ªå…ƒç´ çš„font-sizeç»§æ‰¿äº†çˆ¶å…ƒç´ çš„font-sizeï¼Œæ‰€ä»¥ç¼©è¿›æ¯”ä¸Šé¢çš„å°ä¸€äº›
    </p>
    <p style="font-size: 2rem">ç›¸å¯¹æ ¹å…ƒç´ font-size</p>
</div>
```

vh/vw æ˜¯å±å¹•çš„ç™¾åˆ†æ¯”  
vmin æ˜¯ min(å±å¹•å®½åº¦,å±å¹•é«˜åº¦)ã€vmax æ˜¯ max(å±å¹•å®½åº¦,å±å¹•é«˜åº¦)
{{< /spoiler >}}

{{< spoiler  "for in å’Œ for ofçš„åŒºåˆ«">}}
éå†å¯¹è±¡ï¼šfor...in å¯ä»¥, for...of ä¸å¯ä»¥  
éå† Mapã€Setï¼šfor...of å¯ä»¥, for...in ä¸å¯ä»¥  
éå† generatorï¼šfor...of å¯ä»¥, for...in ä¸å¯ä»¥

```javascript
function* gen() {
    yield 1;
    yield 2;
    yield 3;
}
for (let i of gen()) {
    console.log(i);
}
```

for...in ç”¨äº**å¯æšä¸¾**æ•°æ®ï¼Œå¦‚å¯¹è±¡ã€æ•°ç»„ã€å­—ç¬¦ä¸²

```javascript
Object.defineProperty(obj, "key", {
    enumerable: true, // å¯æšä¸¾
    configurable: false,
    writable: false,
    value: "static",
});
```

for...of ç”¨äº**å¯è¿­ä»£**æ•°æ®ï¼Œå¦‚æ•°ç»„ã€å­—ç¬¦ä¸²ã€Setã€Map

å­˜åœ¨ Symbol.iterator å±æ€§çš„å¯¹è±¡ï¼Œå¯ä»¥ç”¨ for...of è¿­ä»£

![1-7](https://zzydev-1255467326.cos.ap-guangzhou.myqcloud.com/eight-part-essay/1-7.png)

**for await of æœ‰ä»€ä¹ˆä½œç”¨**

```javascript
function createPromise(val) {
    return new Promise((resolve) => {
        setTimeout(() => {
            resolve(val);
        }, 1000);
    });
}

(async function () {
    const p1 = createPromise(100);
    const p2 = createPromise(200);

    const res1 = await p1;
    console.log(res1);
    const res2 = await p2;
    console.log(res2);

    //ç›´æ¥ä¸‰ä¸ªä¸€èµ·æ‰“å°å‡ºæ¥
    const list = [p1, p2];
    Promise.all(list).then((res) => console.log(res));

    // Promise.allçš„ä»£æ›¿å“
    //ç›´æ¥ä¸‰ä¸ªä¸€èµ·æ‰“å°å‡ºæ¥
    for await (let res of list) {
        console.log(res);
    }

    //æ¯éš”ä¸€ç§’æ‰“å°ä¸€ä¸ª
    const arr = [100, 200];
    for (let num of arr) {
        const res = await createPromise(num);
        console.log(res);
    }
})();
```

{{< /spoiler >}}

{{< spoiler  "offsetHeightã€scrollHeightå’ŒclientHeightçš„åŒºåˆ«">}}
![1-8](https://zzydev-1255467326.cos.ap-guangzhou.myqcloud.com/eight-part-essay/1-8.png)
![1_8](http://cdn.zzydev.top//eight-part-essay/1_8.png)
[scrollHeight](https://developer.mozilla.org/zh-CN/docs/Web/API/Element/scrollHeight)  
[scrollTop](https://developer.mozilla.org/zh-CN/docs/Web/API/Element/scrollTop)  
[scrollLeft](https://developer.mozilla.org/zh-CN/docs/Web/API/Element/scrollLeft)  
{{< /spoiler >}}

{{< spoiler  "HTMLCollectionå’ŒNodeListçš„åŒºåˆ«">}}
Node æ˜¯ Element çš„åŸºç±»  
Element æ˜¯å…¶ä»– HTML å…ƒç´ çš„åŸºç±»ï¼Œå¦‚ HTMLDivElement
![1-9](https://zzydev-1255467326.cos.ap-guangzhou.myqcloud.com/eight-part-essay/1-9.png)
HTMLCollection æ˜¯ Element çš„é›†åˆ  
NodeList æ˜¯ Node çš„é›†åˆ  
HTMLCollection å’Œ NodeList éƒ½æ˜¯ç±»æ•°ç»„

```html
<p id="p1">
    <b>node</b> vs <em>element</em
    ><!--æ³¨é‡Š-->
</p>
```

```javascript
const p1 = document.getElementById("p1");
console.log(p1.children); // ä¸åŒ…å«Textå’ŒComment æ˜¯HTMLCollectionç±»å‹
console.log(p1.childNode); // åŒ…å«Textå’ŒComment æ˜¯NodeListç±»å‹

p1.tagName; // Elementç±»å‹å±æ€§
p1.nodeName; // Nodeç±»å‹å±æ€§
```

{{< /spoiler >}}

{{< spoiler  "Nodeå’Œæµè§ˆå™¨çš„EventLoopæœ‰ä»€ä¹ˆåŒºåˆ«">}}
{{< notice notice-tip >}}
å¯ä»¥æŠŠæ‰§è¡Œæ ˆè®¤ä¸ºæ˜¯ä¸€ä¸ªå­˜å‚¨å‡½æ•°è°ƒç”¨çš„æ ˆç»“æ„ï¼Œéµå¾ªå…ˆè¿›åå‡ºçš„åŸåˆ™:
{{< /notice >}}

![1-10](https://zzydev-1255467326.cos.ap-guangzhou.myqcloud.com/eight-part-essay/1-10.gif)
æµè§ˆå™¨ä¸­çš„ EventLoop
å‡½æ•°ä¼šåœ¨æ‰§è¡Œæ ˆä¸­æ‰§è¡Œï¼Œå½“é‡åˆ°å¼‚æ­¥ä»£ç çš„æ—¶å€™ï¼Œä¼šè¢«æŒ‚èµ·åœ¨ Task é˜Ÿåˆ—ä¸­ï¼Œä¸€æ—¦æ‰§è¡Œæ ˆä¸ºç©ºï¼Œå°±ä¼šä» Task é˜Ÿåˆ—ä¸­æ‹¿å‡ºéœ€è¦æ‰§è¡Œçš„ä»£ç æ‰§è¡Œï¼Œæ‰€ä»¥æœ¬è´¨ä¸Šè®² JS ä¸­çš„å¼‚æ­¥è¿˜æ˜¯åŒæ­¥è¡Œä¸ºã€‚
![1-10-1](https://zzydev-1255467326.cos.ap-guangzhou.myqcloud.com/eight-part-essay/1-10-1.png)
ä¸åŒçš„ä»»åŠ¡æºä¼šè¢«åˆ†é…åˆ°ä¸åŒçš„ Task é˜Ÿåˆ—ä¸­ï¼Œä»»åŠ¡æºå¯ä»¥åˆ†ä¸º å¾®ä»»åŠ¡ï¼ˆmicrotaskï¼‰ å’Œ å®ä»»åŠ¡ï¼ˆmacrotaskï¼‰ã€‚

-   å®ä»»åŠ¡(`script`ã€`setTimeout`ã€`setInterval`ã€`setImmidiate`ã€`I/O`ã€`UI Rendering`)
-   å¾®ä»»åŠ¡(`procress.nextTick`ã€`Promise.then`ã€`Object.observe`ã€`mutataionObserver`)

Event Loop æ‰§è¡Œé¡ºåºå¦‚ä¸‹æ‰€ç¤ºï¼š</br>

1. é¦–å…ˆæ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œè¿™å±äºå®ä»»åŠ¡</br>
2. å½“æ‰§è¡Œå®Œæ‰€æœ‰åŒæ­¥ä»£ç åï¼Œæ‰§è¡Œæ ˆä¸ºç©ºï¼ŒæŸ¥è¯¢æ˜¯å¦æœ‰å¼‚æ­¥ä»£ç éœ€è¦æ‰§è¡Œ</br>
3. æ‰§è¡Œæ‰€æœ‰å¾®ä»»åŠ¡</br>
4. å½“æ‰§è¡Œå®Œæ‰€æœ‰å¾®ä»»åŠ¡åï¼Œå¦‚æœ‰å¿…è¦ä¼šæ¸²æŸ“é¡µé¢</br>
5. ç„¶åå¼€å§‹ä¸‹ä¸€è½® Event Loopï¼Œæ‰§è¡Œå®ä»»åŠ¡ä¸­çš„å¼‚æ­¥ä»£ç ï¼Œä¹Ÿå°±æ˜¯ setTimeout ä¸­çš„å›è°ƒå‡½æ•° </br>
   ![1-10-2](https://zzydev-1255467326.cos.ap-guangzhou.myqcloud.com/eight-part-essay/1-10-2.png)

```javascript
const $p1 = $("<p>ä¸€æ®µæ–‡å­—</p>");
const $p2 = $("<p>ä¸€æ®µæ–‡å­—</p>");
const $p3 = $("<p>ä¸€æ®µæ–‡å­—</p>");
$("#container").append($p1).append($p2).append($p3);
//å¾®ä»»åŠ¡: DOMæ¸²æŸ“å‰è§¦å‘
Promise.resolve().then(() => {
    console.log("length1", $("#container").children.length); // 3
    alert("Promise then"); // å‡ºç°alertå¼¹çª—ï¼ŒDOMæ­¤æ—¶æœªæ¸²æŸ“
});
//å®ä»»åŠ¡ï¼šDOMæ¸²æŸ“åè§¦å‘
setTimeout(() => {
    console.log("setTimeout");
});
```

![1-10-3](https://zzydev-1255467326.cos.ap-guangzhou.myqcloud.com/eight-part-essay/1-10-3.png)
{{<detail "å›é¡¾PromiseçŸ¥è¯†ç‚¹">}}

```javascript
//Promise æœ‰ä¸‰ç§çŠ¶æ€ï¼špendingã€resolvedã€rejected
//pending çŠ¶æ€çš„Promiseï¼Œä¸ä¼šè§¦å‘ then æˆ– catch
//resolved çŠ¶æ€çš„ Promiseï¼Œ ä¼šè§¦å‘ then å›è°ƒå‡½æ•°
//rejected çŠ¶æ€çš„ Promiseï¼Œ ä¼šè§¦å‘ catch å›è°ƒå‡½æ•°
const p1 = new Promise((resolve, reject) => {
    setTimeout(() => {
        resolve();
    });
});
console.log("p1", p1); // Promise {<pending>}
setTimeout(() => console.log("p1-setTimeout", p1)); // Promise { <resolved> }

// -------------------------------------------------------------------------

// then æ­£å¸¸è¿”å› resolved çŠ¶æ€çš„ Promiseï¼Œé‡Œé¢æœ‰æŠ¥é”™åˆ™è¿”å› rejected çŠ¶æ€çš„ Promise
// catch æ­£å¸¸è¿”å› resolved çŠ¶æ€çš„ Promiseï¼Œé‡Œé¢æœ‰æŠ¥é”™åˆ™è¿”å› rejected çŠ¶æ€çš„ Promise
const p1 = Promise.reject("my error").catch((err) => console.log(err));
console.log("p1", p1); // âš ï¸ Promise { <resolved> }
const p2 = Promise.reject("my error").then(
    (err) => throw new Error("catch error")
);
console.log("p2", p2); // âš ï¸ Promise { <rejected> }

Promise.resolve()
    .then(() => console.log(1))
    .catch(() => {
        return new Error("err");
    })
    .then(() => console.log(3))
    .catch((err) => console.log(err));
// âš ï¸ 1  3

// -------------------------------------------------------------------------

// async å‡½æ•°è¿”å›çš„æ˜¯ Promise å¯¹è±¡
// await ç›¸å½“äº Promise çš„ then
// try/catch å¯æ•è·å¼‚å¸¸ï¼Œç›¸å½“äº Promise çš„ catch
async function fn1() {
    // return 100; ç›¸å½“äº return Promise.resolve(100)
    return Promise.resolve(100);
}
const res1 = fn1(); // res1: Promise { <resolved> }
!(async function () {
    const p1 = Promise.resolve(100);
    const data = await p1; // await ç›¸å½“äº Promise çš„ then
    console.log(data);
})();
!(async function () {
    const data = await 100; // ç›¸å½“äº await Promise.resolve(100);
    console.log(data);
})();
!(async function () {
    const p1 = Promise.reject(new Error("my error"));
    try {
        const data = await p1;
        console.log(data);
    } catch (err) {
        console.error(err); // try catch ç›¸å½“äº Promise çš„ catch
    }
})();

// -------------------------------------------------------------------------

async function async1() {
    console.log("async1 start"); // 2
    await async2(); //å…ˆæ‰§è¡Œ async2,å†æ‰§è¡Œ await çš„æ“ä½œ
    // await åé¢çš„å†…å®¹ï¼Œéƒ½å¯ä»¥çœ‹æˆ callback çš„å†…å®¹ï¼Œå¾®ä»»åŠ¡
    console.log("async1 end"); // 6
}

async function async2() {
    console.log("async2 start"); // 3
}

console.log("script start"); // 1
setTimeout(() => {
    // å®ä»»åŠ¡
    console.log("setTimeout"); // 8
});
async1();

//åˆå§‹åŒ–Promiseæ—¶ï¼Œä¼ å…¥çš„å‡½æ•°ä¼šç«‹åˆ»è¢«æ‰§è¡Œ
new Promise(function (resolve) {
    console.log("Promise1"); // 4
    resolve();
}).then(() => {
    // å¾®ä»»åŠ¡
    console.log("Promise2"); // 7
});

console.log("script end"); // 5
//åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯• (call stackè¢«æ¸…ç©º)
//æ‰§è¡Œå¾®ä»»åŠ¡
//å°è¯•è¿›è¡ŒDOMæ¸²æŸ“
//è§¦å‘EventLoop æ‰§è¡Œå®ä»»åŠ¡
```

```html
<!--ä¼ªä»£ç -->>
<button id="btn">click</button>
<script>
    // const fn1 = () => {
    //   log("listener1")
    //   Promise.resolve().then(()=>log('micro task 1'));
    // }
    button.addEventListener("click", () => {
        log("listener1");
        Promise.resolve().then(() => log("micro task 1"));
    });
    // const fn2 = () => {...}
    button.addEventListener("click", () => {
        log("listener2");
        Promise.resolve().then(() => log("micro task 2"));
    });
    //æƒ…å†µä¸€ï¼š button.click() // ç›¸å½“äº åŒæ—¶æ‰§è¡Œfn1() fn2() æ‰§è¡Œç»“æœ: l1 l2 t1 t2
    //æƒ…å†µäºŒ: åœ¨htmlé¡µé¢ç‚¹å‡»buttonè§¦å‘ä¸¤æ¬¡clickäº‹ä»¶(ä¸¤ä¸ªå®ä»»åŠ¡) æ‰§è¡Œç»“æœ: l1 t1 l2 t2
</script>
```

```js
Promise.resolve().then(() => {
    console.log("Promise1");
    setTimeout(() => {
        console.log("setTimeout2");
    }, 0);
});
setTimeout(() => {
    console.log("setTimeout1");
    Promise.resolve().then(() => {
        console.log("Promise2");
    });
}, 0);
// p1 s1 p2 s2
```

{{< /detail >}}

{{< /spoiler >}}

{{< spoiler  "æµè§ˆå™¨ç¼“å­˜:å¼ºç¼“å­˜å’Œåå•†ç¼“å­˜">}}
å¼ºç¼“å­˜å¯ä»¥é€šè¿‡è®¾ç½®ä¸¤ç§ HTTP Header å®ç°ï¼š`Expires` å’Œ `Cache-Control` ã€‚å¼ºç¼“å­˜è¡¨ç¤ºåœ¨ç¼“å­˜æœŸé—´ä¸éœ€è¦è¯·æ±‚ï¼Œ`state code` ä¸º 200ã€‚

![1-10](https://zzydev-1255467326.cos.ap-guangzhou.myqcloud.com/eight-part-essay/1-10.png)

{{< /spoiler >}}

{{< spoiler  "åŒæºç­–ç•¥ä¸è·¨åŸŸ">}}

#### ä¸€.æµè§ˆå™¨è¯·æ±‚è·¨åŸŸè§£å†³æ–¹æ¡ˆ

1. [CORS](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS)
2. ä»£ç†è½¬å‘

```js
// webpack-dev-server é…ç½®ä»£ç†
//å½“æµè§ˆå™¨å‘èµ·å‰ç¼€ä¸º /api çš„è¯·æ±‚æ—¶éƒ½ä¼šè¢«è½¬å‘åˆ° http://localhost:3000 è¿™ä¸ªç½‘å€ï¼Œç„¶åå°†å“åº”ç»“æœè¿”å›ç»™æµè§ˆå™¨
module.exports = {
    //...
    devServer: {
        proxy: {
            "/api": "http://localhost:3000",
        },
    },
};

//åœ¨ Nginx æœåŠ¡å™¨ä¸Šé…ç½®è½¬å‘è§„åˆ™
//é€šè¿‡ location æŒ‡ä»¤åŒ¹é…è·¯å¾„ï¼Œç„¶åé€šè¿‡ proxy_pass æŒ‡ä»¤æŒ‡å‘ä»£ç†åœ°å€
location /api {
    proxy_pass   http://localhost:3000;
}
```

3. Websocket

```js
//åœ¨aç½‘ç«™ç›´æ¥åˆ›å»ºä¸€ä¸ªWebSocketè¿æ¥ï¼Œè¿æ¥åˆ°bç½‘ç«™
//ç„¶åè°ƒç”¨WebScoketå®ä¾‹wsçš„send()å‡½æ•°å‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯ï¼Œç›‘å¬å®ä¾‹wsçš„onmessageäº‹ä»¶å¾—åˆ°å“åº”å†…å®¹ã€‚
var ws = new WebSocket("ws://b.com");
ws.onopen = function () {
    // ws.send(...);
};
ws.onmessage = function (e) {
    // console.log(e.data);
};
```

#### äºŒ. é¡µé¢è·¨åŸŸè§£å†³æ–¹æ¡ˆ

ä¾‹å¦‚ä½¿ç”¨ iframe æ—¶çˆ¶å­é¡µé¢ä¹‹é—´è¿›è¡Œé€šä¿¡  
HTML5 çš„ postMessage() å¯ç”¨æ¥å®ç°çˆ¶å­é¡µé¢ä¹‹é—´é€šä¿¡ï¼Œä¸”ä¸è®ºè¿™ä¸¤ä¸ªé¡µé¢æ˜¯å¦åŒæºã€‚  
ä¸¾ä¸ª ğŸŒ° å­ï¼š
å½“çˆ¶é¡µé¢ https://zzydev.top è¦å‘å­é¡µé¢ https://children.zzydev.top å‘æ¶ˆæ¯

```js
// ===================== çˆ¶é¡µé¢ https://zzydev.top ======================================
//é€šè¿‡ window.open() å‡½æ•°æ‰“å¼€äº†å­é¡µé¢ï¼Œ
//ç„¶åè°ƒç”¨ child.postMessage() å‡½æ•°å‘é€äº†å­—ç¬¦ä¸²æ•°æ®ç»™å­é¡µé¢ã€‚
var child = window.open("https://children.zzydev.top");
child.postMessage("hello kids~", "https://children.zzydev.top");

// =====================å­é¡µé¢ https://children.zzydev.top ======================================
// åœ¨å­é¡µé¢ä¸­ï¼Œåªéœ€è¦ç›‘å¬â€œmessageâ€äº‹ä»¶å³å¯å¾—åˆ°çˆ¶é¡µé¢çš„æ•°æ®
window.addEventListener(
    "message",
    function (e) {
        console.log(e.data);
    },
    false
);

//çˆ¶é¡µé¢ä¹Ÿå¯ä»¥ç›‘å¬â€œmessageâ€äº‹ä»¶æ¥æ¥æ”¶å­é¡µé¢å‘é€çš„æ•°æ®ã€‚
//å­é¡µé¢å‘é€æ•°æ®æ—¶åˆ™è¦é€šè¿‡ window.opener å¯¹è±¡æ¥è°ƒç”¨ postMessage() å‡½æ•°ã€‚
window.opener.postMessage("hello dad", "https://zzydev.top");
```

{{< /spoiler >}}
